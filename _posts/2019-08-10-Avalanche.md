---
layout:       post
title:        Comments on the Avalanche Effect
categories:   [math]
tags:         [integer,hash,random]
plotly: false
description:  A quick overview of what "Avalanche Effect" properties are, why they can be used to test and search for PRNGs and overview of how to convert the property into a comparision measurement.
---

\\
In a recent blog post ["A fast 16-bit random number generator?"](https://lemire.me/blog/2019/07/03/a-fast-16-bit-random-number-generator/) Daniel Lemire gives a proof-of-concept PRNG with 16-bits of state. The empirical search strategy used was estimating the [*"Avalanche Effect"*](https://en.wikipedia.org/wiki/Avalanche_effect) of the cadidate parameter and choosing the best. In the comments someone questioned why using a hash measure is reasonable for PRNG. One purpose of the post is to answer that question. Additionally I'll eventually get around to using some of this stuff.

Let's forget all about hashing and say we have some *bit mixing function* $f$ which transforms a register sized integer value to a same sized integer value (not a requirement but KISS) and let's just say 32-bit integers (for bit mixing bigger really is better...but that's another story).  Avalanche is vaguely defined as *"small changes in input produce large changes in output"*. Since that's totally useless we define a couple of desirable properties (stated slightly differently from the common):

> **strict avalanche criterion (SAC):** If we apply $f$ to an input $x$ and to $x$ with the $i^{\text{th}}$ bit flipped then output bits flip with a probability of 1/2. 

So the code for computing the changes for the $i^{\text{th}}$ bit might look like this: `bits = f(x) ^ f(x^(1<<i))`.

> **bit independence criterion (BIC):** If we apply $f$ to an input $x$ and to $x$ with the $i^{\text{th}}$ bit flipped then all other pairs of bit positions should flip independently in the output.

BIC is a stricter and harder measure to pass but after gathering counts (wait for it) proceeds like a SAC based test, so I'm going to ignore that. Also there are variants of SAC tests (such as multiple input bits flipping or nearby inputs) which I'm also going to (mostly) ignore. Changing a single bit has the most value since we're looking how well our mixing function propagates a single bit change in input to all output bits.

-----

**ASIDE:** I'm going to state that it's highly desirable for our function $f$ to be a bijection or *"every input maps to a unique output"*. (I'm gonna keep ignoring different sized input/ouput). If $f$ not a bijection then for a given output there are two or more inputs which produce it this introduces a bias (both for SAC measures and [pigeonhole principle](http://marc-b-reynolds.github.io/math/2016/12/22/Pigeonhole.html) flavored as well.

Now Lemire's 16-bit generator does not use a bijection for the mix and the downside of this is the generator is biased. The upside is it performs amazingly well on a number of PRNG statistics (Yo, this is really hard with 16-bits of state). So the point of this aside is to remember [Goodhart's law](https://en.wikipedia.org/wiki/Goodhart%27s_law) and that desirable properties can be blown off (have weak measures) if we meet our overall goal(s).

-----

Back on topic. SAC: output bits flip with probablity of 1/2. For PRNG we expect the output bits to be set with a probability of 1/2. So feeding a sequence of numbers into $f$ should produce a random number (and yeah there are a bunch of other tests we want to run to see how well it's working). In fact many state-of-the-art random number generators do exactly this.  PCGs generate a LCG and run through a mix and there are quite of few that use Weyl sequences (additive recurrence) followed by mix. A quick reasoning why this is popular is a PRNG state update needs to be a bijection that is full period (this is a hard requirement) and the period of the mixing function doesn't matter at all. So we can use a crappy (in terms of randomness measures) state update and mix it with a very good mixing function.

-----

The remainder of this is spitballing how to make tests out of the desired property. Let jump in a look at a stripped down version that Lemire used:

{% highlight c %}
{
  uint32_t sum = 0;

  // brute-force walk all 16-bit input values
  for (uint32_t x=0; x<=0xffff; x++) {
  
    // hash of the input sample 'x'
    uint32_t h = f(x);
    
    // walk all single bit flips of 'x'
    for (uint32_t i=0; i<16; i++) {
      uint32_t pop = popcount(h ^ f(x ^ (1 << i))) - 16/2;
      pop  = (pop >= 0) ? pop : -pop;
      sum += pop;
    }
  }
  // sum is the "measure"
}
{% endhighlight %}

\\
So he just walk all legal input, flips the bits, finds the changed bits, then:

* computes the [population count](https://en.wikipedia.org/wiki/Hamming_weight) (aka Hamming weight)
* subtracts 8. Why? Each bit should flip with probability of 1/2 so (on average) half the bits should flip at each step
* takes the abs of the previous result
* add this value to the running sum

Nice, short and simple estimation of SAC. Small values are good and big are bad.

\\
Let's run with a skeleton for 32-bit to 32-bit which is not so short:

{% highlight c %}
  // array to hold the counts initialized to zero
  counts[32][32] = { { 0 } };

  // array to hold popcount counts
  popcount[33] = { 0 };

  // walk through 'n' inputs
  for(uint32_t i=0; i<n; i++) {
    uint32_t x = ...;                 // x = the ith input to test
    uint32_t h = f(x);                // hash of x
    
    // walk though flipping each bit of 'x'
    for (uint32_t j=0; j<32; j++) {
      uint32_t pop = 0;
      
      // compute the output bits which flipped
      uint32_t bits = h ^ f(x ^ (1<<j));

      // update count indiviually: 
      for (uint32_t k=0; k<32; k++) {
        uint32_t b = (bits >> k) & 1;
        pop          += b;
        counts[j][k] += b;
      }
      popcount[pop]++;
    }
  }
{% endhighlight %}

\\
The outer structure is pretty much the same. Bullet-point time:

1. We're not brute forcing all input and are instead sampling $n$ values. There are various sampling strategies that can be used, but we're going to ignore that in this post. 
2. The other change is that last loop. We're instead walking individually through the bits in our "which ones flipped" variable `bits` and updating a "matrix" of counts in we which track how output bits flip for each changed input bit position. Additionally this skeleton computes the population count and tracks how many of each we see.

Once this process is done we need to compute a measure of how well we're meeting the expected property.  Let's say we walk through each element of `counts` and divide by the number of samples $\left(n\right)$ we used. We'd have a number on $\left[0,1\right]$.  Zero if the given input bit never flipped the given output bit and one if it always flipped. Since our expectation result is $\frac{1}{2}$ let's subtract that and multiply by two to remap the range to $\left[-1,1\right]$ and call that value the **bias**. If we were to walk through all the bins of `counts` and track the maximum magnitude **bias** we could return that as our measure and we'll call that the **max bias** (this is the $\ell^{\infty}$ or [uniform/supremum/infinity/Chebyshev norm](https://en.wikipedia.org/wiki/Uniform_norm) of the **bias**). This gives us the magnitude of worst case bias (just to state the obvious).

Something completely different we could do with our values in `counts` is to perform a [goodness-of-fit](https://en.wikipedia.org/wiki/Goodness_of_fit) test. The SAC property says that all the values should be uniformly distributed if the function is a good bit mixer.

Another thing we could do with the **bias** is directly visualize its output as a heat map. As a baseline let's look at how an identity function would look:

{% highlight c %}
uint32_t f(uint32_t h) { return h; }
{% endhighlight %}

<p align="center" vertical-align="middle">
<canvas id="sac_id"></canvas>
<canvas id="heat_map"></canvas>
</p>

\\
The legend is off to the right with positive values in red, negative in blue and approaching zero is black. The identity function doesn't mix anything so the only bits that flip are those from performing the test. Reading the figure we have from left-to-right least to most significant output bit and bottom-to-top least to most significant bit flipped on the input sample.

Now let's look at the MurmurHash3 32-bit finalizer at each step. There are really very quite many hash functions which have an identical structure simply with different choices of constants.

{% highlight c %}
uint32_t f(uint32_t h)
{
  h ^= h >> 16; h *= 0x85ebca6b;
  h ^= h >> 13; h *= 0xc2b2ae35;
  h ^= h >> 16;
  return h;
}
{% endhighlight %}

<p align="center" vertical-align="middle">
<canvas id="mh_1"></canvas>
<canvas id="mh_2"></canvas><br>
<canvas id="mh_3"></canvas>
<canvas id="mh_4"></canvas><br>
<canvas id="mh_5"></canvas>
</p>

\\
The figures are in the same order as the code: top-left is first xorshift, top-right the multiply, second row the next xorshift/multiply and last row the final xorshift. The samples are high-entropy (a PRNG source) and the number of samples ($n=1048575$) a middle ground choice (enough that the bias is clear but no so many that the final figure becomes all black).

An older hashing function (Wang hash) is similar to new-jack MurmurHash3 sytle finalizers and is sometime still recommended. Let's look at that:

{% highlight c %}
uint32_t f(uint32_t h)
{
  h = (h ^ 61) ^ (h >> 16);
  h *= 9;
  h ^= h >> 4;
  h *= 0x27d4eb2d;
  h ^= h >> 15;
  return h;
}
{% endhighlight %}


<p align="center" vertical-align="middle">
<canvas id="wang"></canvas>
</p>

-----

Let's very quickly run through was we could do with the population count data. SAC says bits should flip with probability of 1/2. If we think of each bit as a coin tossed in the air (tails=0 and heads=1) then the probability of getting a specific population count is described by the [binomial distribution](https://en.wikipedia.org/wiki/Binomial_distribution):

$$
\left(\begin{array}{l}{n} \\ {k}\end{array}\right) p^{k}(1-p)^{n-k}
$$

\\
where $p$ is the probability (which is 1/2), $n$ is the number of trials (the number of bits) and $k$ the number of successes (the population count). Renaming $n$ (we're already using that) to $b$ and plugging in our fixed $p$ gives:

$$
2^{-b} \left(\begin{array}{l}{b} \\ {k}\end{array}\right)
$$

At this point we have enough information to perform a goodness-of-fit test.

-----

<script>

const cell_w = 5;  // drawn cell size (pixels) w/o padding

const wang = [-5,0,3,-15,-1,5,-8,13,4,2,-7,0,0,0,0,-1,1,3,-15,-1,5,-8,13,4,2,-7,0,-3,0,1,2,1,0,3,-15,-2,6,-9,13,4,2,-7,0,0,0,0,0,1,0,-15,-2,6,-9,13,4,2,-7,0,-3,0,0,-1,1,0,3,-15,-1,6,-8,13,4,2,-7,0,0,0,0,0,1,0,-1,-1,6,-8,13,4,2,-7,0,-3,0,0,0,1,0,1,-16,-2,5,-8,13,4,2,-7,0,0,0,0,0,0,0,-1,0,5,-8,13,4,2,-7,0,-2,0,0,0,0,0,0,1,-3,5,-8,13,3,2,-7,0,0,0,0,0,0,0,0,0,0,-8,13,3,2,-7,0,-3,0,0,0,0,0,0,0,0,5,-9,13,4,2,-7,0,-1,0,0,0,0,0,0,0,0,0,13,4,2,-7,0,-3,0,1,0,0,0,0,0,0,1,-8,13,4,2,-6,-1,0,0,0,0,0,0,0,0,0,0,0,4,2,-6,1,-3,0,0,0,0,0,0,0,0,0,1,12,4,2,-7,0,-1,0,1,1,0,0,0,0,0,0,0,0,2,-7,0,-2,0,0,0,0,0,0,0,0,0,0,1,4,2,-7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-7,0,-3,0,0,0,0,0,0,0,0,1,1,1,0,3,-7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-3,0,0,0,0,0,0,0,0,0,1,1,0,0,-6,-3,-3,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,-3,0,-1,-1,0,0,1,0,0,0,1,1,0,0,-1,-3,-3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,0,-2,0,3,0,2,1,0,0,0,0,0,0,0,0,-1,0,0,0,-1,-1,4,0,1,0,0,0,0,0,0,0,1,-1,-1,0,0,3,-8,0,0,1,-1,1,0,0,0,-1,0,0,0,-1,0,10,0,0,0,0,-1,0,1,-1,-1,0,-1,0,-1,0,3,-7,0,0,1,0,0,0,0,1,-1,0,0,0,0,0,0,-1,0,1,0,0,1,0,0,0,0,-1,0,-1,0,0,7,-1,0,1,-1,0,0,1,2,1,-1,0,0,-2,-1,0,0,0,0,1,0,1,-2,-1,-1,0,1,0,1,0,0,1,-5,0,3,-15,-1,5,-8,13,4,2,-7,0,0,1,0,-3,4,3,-15,-1,5,-8,13,4,2,-7,0,3,-2,-4,9,1,0,3,-15,-2,6,-9,13,4,2,-7,0,0,1,0,-3,4,0,-15,-2,6,-9,13,4,2,-7,0,3,-2,-4,9,1,2,3,-15,-1,6,-8,13,4,2,-7,0,0,1,1,-2,3,0,-4,-1,6,-8,13,4,2,-7,0,3,-2,-4,9,2,1,6,-16,-2,5,-8,13,4,2,-7,0,0,1,1,-3,4,0,-4,-3,5,-8,13,4,2,-7,0,2,-2,-3,9,1,2,6,-4,-3,5,-8,13,3,2,-7,0,0,1,1,-3,4,0,-4,-3,16,-8,13,3,2,-7,0,3,-2,-3,9,1,2,5,-4,-3,5,-9,13,4,2,-7,0,1,1,0,-3,3,0,-4,-2,16,-4,13,4,2,-7,0,3,-2,-4,9,1,2,6,-4,-3,4,-8,13,4,2,-6,-1,0,1,1,-3,3,1,-4,-2,15,-4,-1,4,2,-6,1,3,-2,-3,9,1,2,5,-5,-2,4,2,12,4,2,-7,0,1,2,0,-3,3,0,-5,-2,16,-4,-2,1,2,-7,0,2,-2,-3,10,1,2,6,-4,-3,4,3,-7,4,2,-7,0,0,0,1,-2,3,0,-4,-2,16,-3,-2,1,-22,-7,0,3,-2,-3,10,2,2,6,-4,-3,4,3,-8,1,3,-7,1,0,2,1,-3,4,0,-3,-4,15,-5,-2,1,-22,1,-1,3,-6,-5,8,0,1,10,0,-3,5,2,-7,1,-22,-6,-3,3,2,1,0,3,2,-3,-4,13,-2,-3,0,-19,2,-4,3,-2,-3,6,-2,3,5,-6,-3,3,3,-6,1,-15,-12,-3,3,2,0,-2,5,2,-4,-1,13,-4,-3,-1,-20,2,-5,-9,-2,-3,5,-2,3,5,-6,-3,3,3,-7,1,-15,-12,-9,-3,-8,-1,-1,-6,13,5,8,9,6,0,-8,24,-1,-1,7,-3,2,-16,-3,-7,-9,6,-3,5,3,6,10,15,2,1,10,-11,-3,62,0,23,28,-3,27,6,-3,-15,49,-8,-2,12,-13,-4,-39,-10,-10,-20,9,-4,12,-3,13,27,28,23,2,28,-15,-3,61,11,1,34,14,31,9,0,-14,49,-8,-2,12,-13,-4,-21,-10,-10,-20,9,-4,12,-4,13,26,29,22,3,29,-15,-18,-62,-60,32,22,-9,56,-12,34,-36,-59,16,-5,-21,3,-27,27,15,10,48,5,15,-33,-44,24,24,27,-22,68,-37,12,11,-1];

const sac_id = [-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255];

const mh_1 = [-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255];

const mh_2 = [-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,80,-88,172,-42,149,53,101,77,-89,172,-42,148,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,79,-88,171,-42,148,53,101,77,-89,172,-42,148,0,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,79,-88,172,-41,148,53,101,77,-89,172,-42,148,0,-127,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,79,-88,172,-42,149,53,101,77,-89,172,-41,148,1,-127,-13,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,0,128,64,96,80,-88,172,-42,149,53,101,77,-89,172,-41,149,0,-128,-13,-96,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,0,128,64,96,80,-88,171,-42,149,53,101,77,-89,172,-41,148,0,-127,-13,-96,-67,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,1,127,64,95,80,-87,171,-42,148,53,101,77,-89,172,-42,148,0,-127,-13,-96,-67,-88,-255,-255,-255,-255,-255,-255,-255,-255,255,6,124,65,95,80,-88,171,-42,148,53,101,78,-89,172,-42,148,0,-127,-13,-96,-67,-88,171,-255,-255,-255,-255,-255,-255,-255,255,4,125,65,95,80,-88,171,-42,148,53,101,77,-89,172,-42,148,0,-127,-13,-95,-67,-87,171,-42,-255,-255,-255,-255,-255,-255,255,-8,132,62,97,79,-88,172,-42,149,53,101,77,-89,172,-41,148,0,-127,-13,-96,-67,-88,171,-42,-149,-255,-255,-255,-255,-255,255,80,87,84,86,85,-85,170,-42,149,53,101,77,-89,172,-42,148,0,-128,-13,-96,-67,-88,171,-42,-149,-10,-255,-255,-255,-255,255,95,80,87,84,86,-85,170,-42,148,53,101,77,-89,172,-42,149,0,-127,-13,-95,-67,-88,171,-42,-148,-10,-101,-255,-255,-255,255,64,95,80,87,84,-85,170,-42,149,53,101,77,-89,172,-42,149,0,-127,-13,-95,-67,-88,172,-42,-148,-10,-101,66,-255,-255,255,127,64,95,80,87,-84,169,-43,149,53,101,77,-89,172,-41,148,0,-128,-13,-96,-67,-87,171,-42,-149,-10,-101,66,-89,-255,255,0,127,64,95,80,-88,172,-42,149,53,101,77,-89,172,-42,148,0,-128,-13,-96,-67,-88,172,-42,-149,-10,-101,66,-89,172,255,255,0,127,64,96,-80,167,-44,150,53,101,77,-89,172,-42,148,0,-128,-13,-96,-67,-88,171,-42,-148,-10,-100,67,-89,172,42,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,80,-88,172,-42,149,53,101,77,-89,172,-42,-148,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,79,-88,171,-42,148,53,101,77,-89,172,-42,-148,-202,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,79,-88,172,-41,148,53,101,77,-89,172,-42,-148,-202,228,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,-1,128,63,96,79,-88,172,-42,149,53,101,77,-89,172,-41,-148,-202,228,14,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,0,128,64,96,80,-88,172,-42,149,53,101,77,-89,172,-41,-149,-202,228,13,121,-255,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,0,128,64,96,80,-88,171,-42,149,53,101,77,-89,172,-41,-148,-202,228,13,121,67,-255,-255,-255,-255,-255,-255,-255,-255,-255,255,1,127,64,95,80,-87,171,-42,148,53,101,77,-89,172,-42,-148,-202,228,13,121,66,-94,-255,-255,-255,-255,-255,-255,-255,-255,255,6,124,65,95,80,-88,171,-42,148,53,101,78,-89,172,-42,-148,-202,228,14,121,67,-94,-174,-255,-255,-255,-255,-255,-255,-255,255,4,125,65,95,80,-88,171,-42,148,53,101,77,-89,172,-42,-148,-202,228,14,121,67,-94,-175,-215,-255,-255,-255,-255,-255,-255,255,-8,132,62,97,79,-88,172,-42,149,53,101,77,-89,172,-41,-148,-202,228,13,121,67,-94,-175,-215,235,-255,-255,-255,-255,-255,255,80,87,84,86,85,-85,170,-42,149,53,101,77,-89,172,-42,-148,-202,228,13,121,67,-94,-175,-215,235,10,-255,-255,-255,-255,255,95,80,87,84,86,-85,170,-42,148,53,101,77,-89,172,-42,-149,-202,228,14,121,67,-94,-175,-215,235,10,122,-255,-255,-255,255,64,95,80,87,84,-85,170,-42,149,53,101,77,-89,172,-42,-149,-202,228,14,120,67,-94,-174,-215,235,10,122,-66,-255,-255,255,127,64,95,80,87,-84,169,-43,149,53,101,77,-89,172,-41,-148,-201,228,14,121,67,-94,-174,-215,235,10,123,-66,-161,-255,255,0,127,64,95,80,-88,172,-42,149,53,101,77,-89,172,-42,-148,-202,228,13,121,67,-94,-174,-215,235,10,123,-66,-161,-208,255,255,0,127,64,96,-80,167,-44,150,53,101,77,-89,172,-42,-148,-202,228,13,121,67,-94,-174,-214,235,10,122,-66,-161,-208,231];

const mh_3 = [-255,-255,255,-1,128,63,96,80,-88,172,-42,149,53,101,77,89,0,21,-37,96,80,-88,172,-42,149,53,101,77,-89,172,-42,148,-255,255,-1,128,63,96,79,-88,171,-42,148,53,101,77,89,1,21,-37,0,79,-88,171,-42,148,53,101,77,-89,172,-42,148,0,255,-1,128,63,96,79,-88,172,-41,148,53,101,77,89,1,21,-37,0,40,-88,172,-41,148,53,101,77,-89,172,-42,148,0,-127,-1,128,63,96,79,-88,172,-42,149,53,101,77,89,1,21,-37,0,40,-5,172,-42,149,53,101,77,-89,172,-41,148,1,-127,-13,128,64,96,80,-88,172,-42,149,53,101,77,89,0,21,-37,0,39,-4,64,-42,149,53,101,77,-89,172,-41,149,0,-128,-13,-96,64,96,80,-88,171,-42,149,53,101,77,89,0,21,-37,0,40,-4,64,-11,149,53,101,77,-89,172,-41,148,0,-127,-13,-96,-67,95,80,-87,171,-42,148,53,101,77,89,0,21,-38,0,40,-4,65,-11,51,53,101,77,-89,172,-42,148,0,-127,-13,-96,-67,-88,80,-88,171,-42,148,53,101,78,89,-4,20,-38,0,40,-4,64,-11,51,-36,101,78,-89,172,-42,148,0,-127,-13,-96,-67,-88,171,-88,171,-42,148,53,101,77,89,-3,20,-38,0,40,-5,64,-11,51,-36,17,77,-89,172,-42,148,0,-127,-13,-95,-67,-87,171,-42,172,-42,149,53,101,77,89,5,21,-36,0,39,-4,64,-11,51,-35,17,45,-89,172,-41,148,0,-127,-13,-96,-67,-88,171,-42,-149,-42,149,53,101,77,89,-53,14,-49,0,42,-5,64,-12,51,-36,17,45,-4,172,-42,148,0,-128,-13,-96,-67,-88,171,-42,-149,-10,148,53,101,77,89,-64,13,-51,0,43,-4,64,-10,51,-36,17,45,-4,68,-42,149,0,-127,-13,-95,-67,-88,171,-42,-148,-10,-101,53,101,77,89,-44,16,-47,0,42,-4,64,-11,51,-35,17,45,-4,68,11,149,0,-127,-13,-95,-67,-88,172,-42,-148,-10,-101,66,101,77,89,-86,11,-55,0,44,-4,64,-11,51,-35,17,45,-4,68,11,51,0,-128,-13,-96,-67,-87,171,-42,-149,-10,-101,66,-89,77,89,0,20,-37,0,40,-5,64,-11,51,-36,16,45,-3,68,10,52,10,-128,-13,-96,-67,-88,172,-42,-149,-10,-101,66,-89,172,89,-172,0,-74,0,48,-4,63,-12,52,-35,16,45,-4,68,11,52,10,18,-13,-96,-67,-88,171,-42,-148,-10,-100,67,-89,172,42,-255,-255,255,-1,128,63,96,80,-88,172,-42,149,53,101,77,89,0,21,37,96,80,-88,172,-42,149,53,101,77,-89,172,-42,-148,-255,255,-1,128,63,96,79,-88,171,-42,148,53,101,77,89,1,21,37,76,79,-88,171,-42,148,53,101,77,-89,172,-42,-148,-202,255,-1,128,63,96,79,-88,172,-41,148,53,101,77,89,1,21,37,76,-71,-88,172,-41,148,53,101,77,-89,172,-42,-148,-202,228,-1,128,63,96,79,-88,172,-42,149,53,101,77,89,1,21,37,76,-71,5,172,-42,149,53,101,77,-89,172,-41,-148,-202,228,14,128,64,96,80,-88,172,-42,149,53,101,77,89,0,21,37,76,-71,4,-81,-42,149,53,101,77,-89,172,-41,-149,-202,228,13,121,64,96,80,-88,171,-42,149,53,101,77,89,0,21,37,76,-71,4,-81,11,149,53,101,77,-89,172,-41,-148,-202,228,13,121,67,95,80,-87,171,-42,148,53,101,77,89,0,21,38,75,-72,5,-82,11,55,53,101,77,-89,172,-42,-148,-202,228,13,121,66,-94,80,-88,171,-42,148,53,101,78,89,-4,20,38,75,-72,5,-81,11,54,37,101,78,-89,172,-42,-148,-202,228,14,121,67,-94,-174,-88,171,-42,148,53,101,77,89,-3,20,38,75,-71,5,-81,11,54,37,85,77,-89,172,-42,-148,-202,228,14,121,67,-94,-175,-215,172,-42,149,53,101,77,89,5,21,36,76,-71,5,-81,12,55,37,85,-71,-89,172,-41,-148,-202,228,13,121,67,-94,-175,-215,235,-42,149,53,101,77,89,-53,14,49,68,-76,4,-81,11,55,36,85,-71,3,172,-42,-148,-202,228,13,121,67,-94,-175,-215,235,10,148,53,101,77,89,-64,13,51,67,-76,5,-80,11,55,37,85,-71,4,-83,-42,-149,-202,228,14,121,67,-94,-175,-215,235,10,122,53,101,77,89,-44,16,47,69,-75,4,-80,11,55,36,85,-71,4,-83,-11,-149,-202,228,14,120,67,-94,-174,-215,235,10,122,-66,101,77,89,-86,11,55,63,-78,5,-80,11,55,36,85,-71,3,-83,-11,-93,-201,228,14,121,67,-94,-174,-215,235,10,123,-66,-161,77,89,0,20,37,75,-71,5,-81,11,55,37,85,-71,4,-83,-11,-93,-164,228,13,121,67,-94,-174,-215,235,10,123,-66,-161,-208,89,-172,0,74,51,-86,4,-80,11,55,36,85,-71,4,-82,-11,-94,-165,-207,13,121,67,-94,-174,-214,235,10,122,-66,-161,-208,231];

const mh_4 = [-255,-255,255,0,-64,16,24,1,10,3,0,2,0,-1,1,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-255,255,-1,-128,0,24,-4,10,3,2,2,0,-1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,255,-1,-128,0,32,4,8,2,1,3,0,-1,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,128,-63,-64,15,-14,-16,-2,-1,-1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,128,64,-95,-32,-24,1,-3,1,-3,-1,0,2,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,64,96,-79,48,20,6,-12,-4,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,80,87,-40,0,4,-4,-1,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,80,-88,4,0,-1,2,5,-1,-5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,-88,171,42,-86,0,13,-5,-7,-1,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172,-42,-65,0,16,6,-3,3,0,-1,0,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-42,149,-53,-74,13,16,4,3,-1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,148,53,-101,-27,25,11,-3,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,53,101,-77,-50,0,-11,2,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,101,77,-89,44,0,-6,-1,0,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,77,89,0,-20,-16,0,-3,0,3,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,89,-172,0,53,0,5,-2,-3,0,-1,3,0,1,1,0,0,0,1,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,-255,-255,255,0,-64,16,24,1,10,3,0,2,0,-1,1,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-255,255,-1,-128,0,24,-4,10,3,2,2,0,-1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,255,-1,-128,0,32,4,8,2,1,3,0,-1,0,0,0,0,1,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,-1,128,-63,-64,15,-14,-16,-2,-1,-1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,64,-95,-32,-24,1,-3,1,-3,-1,0,2,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,64,96,-79,48,20,6,-12,-4,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,95,80,87,-40,0,4,-4,-1,3,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,80,-88,4,0,-1,2,5,-1,-5,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,-1,0,0,0,-88,171,42,-86,0,13,-5,-7,-1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172,-42,-65,0,16,6,-3,3,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-42,149,-53,-74,13,16,4,3,1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,148,53,-101,-27,25,11,-3,0,1,-1,0,-1,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,53,101,-77,-50,0,-11,-2,4,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,101,77,-89,44,0,6,2,-4,4,-1,-1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,77,89,0,-20,16,-11,-3,-1,1,-1,0,0,-1,-1,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,89,-172,0,-53,8,13,4,4,7,-1,1,0,-1,0,0,-1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0];

const mh_5 = [-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,-1,0,0,0,1,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,-1,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0];

function viz_fill(pix,x,y,w, r,g,b)
{
  var sx = (cell_w+1);
  var i  = 2 + sx*(w+x+y+sx*w*y);
 
  i *= 4;

  for(var k=0; k<cell_w; k++) {
    for(var j=0; j<cell_w;j++) {
      pix[i+0] = r;
  	  pix[i+1] = g;
      pix[i+2] = b;
      pix[i+3] = 255;
	  i += 4;
    }
    i += 4*(2+sx*w-sx);
  }
}

function color(v)
{
  var r,g,b;

  if (v == 0) { r=g=b=0; } else
  if (v >= 0) {
     r = (v>>1) + 128; 
     g = v>>2;
     b = v>>1;
   } else {
     v = -v;
     b = (v>>1) + 128; 
     r = v>>2;
     g = v>>1;
 }

  return [r,g,b];
}

function viz_bias(name,data,w,h)
{
  var cw  = (cell_w+1)*w+1;
  var ch  = (cell_w+1)*h+1;
  var id  = document.getElementById(name);
  var ctx = id.getContext('2d');
  var img = ctx.createImageData(cw,ch);
  var pix = img.data;
  var si  = 0;
  
  id.width  = cw;
  id.height = ch;

  pix.fill(128);

  for (var y=0; y<h; y++) {
    for (var x=0; x<w; x++)  {
	  var c = color(data[si++]);
	  viz_fill(pix, x, y, w, c[0],c[1],c[2]);
    }
  }

  ctx.putImageData(img,0,0)
}

// temp hack
function viz_legend(name,w,h)
{
  var y;
  w = (cell_w+1)*w+1;
  h = (cell_w+1)*h+1;

  var s = 2.0/h;

  var id  = document.getElementById(name);

  if (id != null) {
    var ctx = id.getContext('2d');
    var img = ctx.createImageData(w,h);
    var pix = img.data;
	
	id.width  = 2*w;
    id.height = h;
    pix.fill(255);

    for (var y=0; y<=h; y++) {
      var c = color(Math.round(255.5*(1-s*y)));
	  var i = 4*y*w;
	  
      for (var x=0; x<w; x++)  {
        pix[i+0] = c[0];
  	    pix[i+1] = c[1];
        pix[i+2] = c[2];
        pix[i+3] = 255;
	    i += 4;
      }
    }

    ctx.putImageData(img,0,0)
    return img;
  }
  else console.log('opps');
}

// sigh
function viz_dup(name,data)
{
  var id  = document.getElementById(name);
  if (id != null) {
    id.getContext('2d').putImageData(data,0,0);
  }
}

viz_bias('sac_id',  sac_id,  32,32);

viz_bias('mh_1', mh_1, 32,32);
viz_bias('mh_2', mh_2, 32,32);
viz_bias('mh_3', mh_3, 32,32);
viz_bias('mh_4', mh_4, 32,32);
viz_bias('mh_5', mh_5, 32,32);

viz_bias('wang', wang, 32,32);
viz_bias('oat',  oat,  32,32);

var leg_32 = viz_legend('heat_map',2,32); 

</script>

